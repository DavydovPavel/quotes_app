{% extends 'base.html' %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        {% if quote %}
        <div class="card mb-4">
            <div class="card-body">
                <blockquote class="blockquote mb-0">
                    <p class="fs-5">{{ quote.text }}</p>
                    <footer class="blockquote-footer mt-2">
                        {{ quote.source }} 
                        <small class="text-muted">(üëÅÔ∏è {{ quote.views_count }})</small>
                    </footer>
                </blockquote>
                
                <div class="mt-3 d-flex align-items-center">
                    <button class="btn btn-outline-success btn-sm like-btn me-2" 
                            data-quote-id="{{ quote.id }}" 
                            data-action="like">
                        ‚ù§Ô∏è <span id="likes-{{ quote.id }}">{{ quote.likes }}</span>
                    </button>
                    <button class="btn btn-outline-secondary btn-sm like-btn me-3" 
                            data-quote-id="{{ quote.id }}" 
                            data-action="dislike">
                        üíî <span id="dislikes-{{ quote.id }}">{{ quote.dislikes }}</span>
                    </button>
                    <span class="text-muted">
                        –†–µ–π—Ç–∏–Ω–≥: <span id="rating-{{ quote.id }}">{{ quote.rating }}</span>
                    </span>
                </div>
            </div>
        </div>
        {% else %}
        <div class="alert alert-info">
            üìù –ü–æ–∫–∞ –Ω–µ—Ç —Ü–∏—Ç–∞—Ç. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é!
        </div>
        {% endif %}

        <a href="{% url 'random_quote' %}" class="btn btn-primary">üé≤ –°–ª–µ–¥—É—é—â–∞—è —Ü–∏—Ç–∞—Ç–∞</a>
    </div>

    <div class="col-md-4">
        <div class="card mb-3">
            <div class="card-header">üìö –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫</div>
            <div class="card-body">
                <form method="post" action="{% url 'add_source' %}">
                    {% csrf_token %}
                    {{ add_source_form.as_p }}
                    <button type="submit" class="btn btn-success btn-sm">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
                </form>
            </div>
        </div>

        <div class="card">
            <div class="card-header">üí¨ –î–æ–±–∞–≤–∏—Ç—å —Ü–∏—Ç–∞—Ç—É</div>
            <div class="card-body">
                <form method="post" action="{% url 'add_quote' %}">
                    {% csrf_token %}
                    {{ add_quote_form.as_p }}
                    <button type="submit" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.like-btn').forEach(button => {
        button.addEventListener('click', function() {
            const quoteId = this.dataset.quoteId;
            const action = this.dataset.action;
            
            fetch(`/quote/${quoteId}/like/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `action=${action}`
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById(`likes-${quoteId}`).textContent = data.likes;
                document.getElementById(`dislikes-${quoteId}`).textContent = data.dislikes;
                document.getElementById(`rating-${quoteId}`).textContent = data.rating;
            });
        });
    });
});
</script>
{% endblock %}
